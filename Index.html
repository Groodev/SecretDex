<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SecretDex (fixed)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        :root{--glass-bg:rgba(255,255,255,0.06);--glass-border:rgba(255,255,255,0.12);--primary-color:#6e56cf;--primary-hover:#7d64dd;--text-color:#ffffff;--body-bg:#0a0a0c;--card-bg:rgba(16,16,20,0.6);--modal-bg:rgba(28,28,35,0.95);--success-color:#10b981;--warning-color:#f59e0b;--danger-color:#ef4444;--info-color:#3b82f6;--scroll-width:6px;--scroll-track:#000;--scroll-thumb:#3a114a;--scroll-thumb-hover:#470c56;--blob-opacity:0.4}
        /* Light mode variables applied when body has .light-mode */
        body.light-mode{--glass-bg:rgba(0,0,0,0.05);--glass-border:rgba(0,0,0,0.08);--primary-color:#6e56cf;--primary-hover:#7d64dd;--text-color:#111827;--body-bg:#ffffff;--card-bg:rgba(255,255,255,0.95);--modal-bg:rgba(255,255,255,0.98);--scroll-track:#f0f0f0;--scroll-thumb:#cccccc;--scroll-thumb-hover:#aaaaaa;--blob-opacity:0.18}
        *{margin:0;padding:0;box-sizing:border-box}
        ::-webkit-scrollbar{width:var(--scroll-width)}
        ::-webkit-scrollbar-track{background:var(--scroll-track);border-radius:2px}
        ::-webkit-scrollbar-thumb{background:var(--scroll-thumb);border-radius:2px}
        ::-webkit-scrollbar-thumb:hover{background:var(--scroll-thumb-hover)}
        body{font-family:"Inter",sans-serif;background:var(--body-bg);color:var(--text-color);min-height:100vh;overflow-x:hidden}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        @keyframes scaleIn{from{transform:scale(0.95);opacity:0}to{transform:scale(1);opacity:1}}
        @keyframes slideIn{from{transform:translateX(-20px);opacity:0}to{transform:translateX(0);opacity:1}}
        .blob{position:fixed;width:600px;height:600px;border-radius:50%;filter:blur(80px);opacity:var(--blob-opacity);z-index:-1;animation:float 20s ease-in-out infinite}
        .blob1{background:linear-gradient(45deg,#6e56cf,#2d3748);top:-200px;left:-200px}
        body.light-mode .blob1{background:linear-gradient(45deg,#a78bfa,#cbd5e1)}
        .blob2{background:linear-gradient(45deg,#4c1d95,#2563eb);bottom:-300px;right:-200px;animation-delay:-5s}
        body.light-mode .blob2{background:linear-gradient(45deg,#7c3aed,#60a5fa)}
        .blob3{background:linear-gradient(45deg,#4338ca,#1e40af);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:-10s}
        body.light-mode .blob3{background:linear-gradient(45deg,#6366f1,#3b82f6)}
        @keyframes float{0%,100%{transform:translate(0,0) scale(1)}25%{transform:translate(50px,-50px) scale(1.1)}50%{transform:translate(-50px,50px) scale(0.9)}75%{transform:translate(50px,50px) scale(1.05)}}
        .glass{background:var(--glass-bg);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:12px}
        .container{max-width:1200px;margin:0 auto;padding:18px;position:relative;z-index:1;animation:fadeIn 0.6s ease-out}
        /* NAVBAR: use grid for stable layout on desktop */
        .desktop-nav{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:16px;padding:12px 18px;position:sticky;top:10px;z-index:30;background:var(--glass-bg);border-radius:12px;margin:10px}
        .logo h1{font-size:1.4rem;margin-left:6px;text-shadow:0 0 20px rgba(110,86,207,0.5);animation:scaleIn 0.8s ease-out}
        .nav-center{justify-self:center;width:100%;max-width:700px}
        .search-bar{display:flex;gap:10px;flex:1}
        .search-wrapper{position:relative;flex:1}
        .search-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--primary-color);transition:transform 0.3s ease}
        .search-input{width:100%;padding:10px 12px 10px 38px;font-size:0.95rem;background:rgba(255,255,255,0.03);border:1px solid var(--glass-border);border-radius:10px;color:var(--text-color);transition:all 0.3s ease}
        body.light-mode .search-input{background:rgba(0,0,0,0.05)}
        .search-input:focus{border-color:var(--primary-color);outline:none}
        .search-input:focus + .search-icon{transform:translateY(-50%) scale(1.1);color:var(--primary-hover)}
        .search-button{padding:10px 14px;background:var(--primary-color);color:white;border:none;border-radius:10px;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:8px}
        .search-button:hover{background:var(--primary-hover);transform:translateY(-2px)}
        .controls{display:flex;align-items:center;gap:12px}
        .theme-toggle button{padding:8px 10px;border-radius:8px;border:none;background:var(--glass-bg);cursor:pointer;color:var(--text-color);font-size:1.5em;transition:transform 0.3s ease}
        .theme-toggle button:hover{transform:scale(1.1)}

        /* Advantages - larger, no scroll, not tiny */
        .hero-section{text-align:center;margin:26px 0;animation:fadeIn 0.8s ease-out}
        .hero-title{font-size:1.9rem;margin-bottom:8px}
        .hero-desc{font-size:0.98rem;margin-bottom:18px;color:rgba(255,255,255,0.85)}
        body.light-mode .hero-desc{color:rgba(0,0,0,0.7)}
        .advantages{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin-top:10px}
        .advantage-card{background:var(--card-bg);border-radius:14px;padding:18px 20px;min-width:300px;max-width:360px;display:flex;align-items:center;gap:14px;border:1px solid var(--glass-border);transition:all .25s ease;flex:1}
        .advantage-card:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(0,0,0,0.25);border-color:var(--primary-color)}
        .advantage-number{font-size:1.6rem;font-weight:700;color:var(--primary-color);min-width:90px;text-align:center}
        .advantage-text{font-size:1rem;flex:1}

        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin:22px 0;animation:fadeIn 0.8s ease-out}
        .card{background:var(--card-bg);border-radius:12px;overflow:hidden;border:1px solid var(--glass-border);transition:all .4s cubic-bezier(0.4,0,0.2,1);animation:scaleIn 0.6s ease-out;cursor:pointer}
        .card:hover{transform:translateY(-5px) scale(1.02);box-shadow:0 8px 20px rgba(0,0,0,0.3);border-color:var(--primary-color)}
        .card img{width:100%;height:180px;object-fit:cover;transition:transform 0.4s ease}
        .card:hover img{transform:scale(1.05)}
        .card-content{padding:12px}
        .card-title{font-size:1.05rem;margin-bottom:6px;color:var(--text-color)}
        .card-game{font-size:0.9rem;color:rgba(255,255,255,0.95)}
        body.light-mode .card-game{color:rgba(0,0,0,0.7)}

        /* Modal */
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(6px);z-index:1000;padding:18px;align-items:center;justify-content:center}
        body.light-mode .modal{background:rgba(255,255,255,0.6)}
        .modal-content{max-width:900px;width:100%;background:var(--modal-bg);padding:18px;border-radius:12px;position:relative;animation:scaleIn 0.4s ease-out}
        .close{position:absolute;right:14px;top:12px;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--glass-bg);cursor:pointer;transition:all 0.3s ease;color:var(--text-color)}
        .close:hover{background:var(--primary-color);transform:rotate(90deg)}
        .minimal-details-card{display:flex;flex-direction:column;gap:25px}
        .details-header{display:flex;gap:30px;align-items:flex-start;padding-bottom:25px;border-bottom:1px solid var(--glass-border);animation:slideIn 0.6s ease-out}
        .header-image{flex-shrink:0}
        .header-image img{width:140px;height:140px;border-radius:16px;object-fit:cover;border:2px solid var(--glass-border);transition:transform 0.3s ease}
        .header-image img:hover{transform:scale(1.05)}
        .header-info{flex-grow:1}
        .header-info h3{font-size:2.2em;color:var(--text-color);margin-bottom:15px;line-height:1.2}
        .details-tags{display:flex;flex-wrap:wrap;gap:12px;margin-top:20px}
        .tag{padding:8px 16px;border-radius:30px;font-size:0.9em;font-weight:500;display:flex;align-items:center;gap:6px;transition:all 0.3s ease}
        .tag i{font-size:1em}
        .tag.verified{background:rgba(16,185,129,0.15);color:var(--success-color);border:1px solid rgba(16,185,129,0.3)}
        .tag.verified:hover{background:rgba(16,185,129,0.25)}
        .tag.not-verified{background:rgba(239,68,68,0.15);color:var(--danger-color);border:1px solid rgba(239,68,68,0.3)}
        .tag.not-verified:hover{background:rgba(239,68,68,0.25)}
        .tag.active{background:rgba(59,130,246,0.15);color:var(--info-color);border:1px solid rgba(59,130,246,0.3)}
        .tag.active:hover{background:rgba(59,130,246,0.25)}
        .tag.patched{background:rgba(234,88,12,0.15);color:var(--warning-color);border:1px solid rgba(234,88,12,0.3)}
        .tag.patched:hover{background:rgba(234,88,12,0.25)}
        .tag.paid{background:rgba(245,158,11,0.15);color:var(--warning-color);border:1px solid rgba(245,158,11,0.3)}
        .tag.paid:hover{background:rgba(245,158,11,0.25)}
        .tag.key{background:rgba(139,92,246,0.15);color:var(--primary-color);border:1px solid rgba(139,92,246,0.3)}
        .tag.key:hover{background:rgba(139,92,246,0.25)}
        .details-section{background:var(--glass-bg);border-radius:16px;padding:25px;animation:fadeIn 0.6s ease-out}
        .details-section h4{color:var(--primary-color);font-size:1.4em;margin-bottom:20px;display:flex;align-items:center;gap:10px}
        .details-section h4 i{font-size:1.1em;opacity:0.9}
        .details-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px}
        .info-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--glass-bg);border-radius:12px;transition:all 0.3s ease}
        .info-item:hover{background:rgba(110,86,207,0.1);transform:translateX(5px)}
        .info-item i{color:var(--primary-color);font-size:1.2em}
        .script-box{background:var(--glass-bg);border-radius:16px;padding:25px;animation:fadeIn 0.8s ease-out;margin-top:20px}
        .script-box h4{color:var(--primary-color);font-size:1.4em;margin-bottom:20px;display:flex;align-items:center;gap:10px}
        .code-container{position:relative;border-radius:12px;overflow:hidden}
        .code-container pre{background:rgba(0,0,0,0.3);padding:25px;border-radius:12px;overflow-x:auto;font-family:"Fira Code",monospace;font-size:0.95em;line-height:1.5;margin-bottom:15px;border:1px solid var(--glass-border)}
        body.light-mode .code-container pre{background:rgba(0,0,0,0.1)}
        .copy-button{position:absolute;top:15px;right:15px;padding:10px 20px;background:var(--primary-color);color:white;border:none;border-radius:8px;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:8px}
        .copy-button:hover{background:var(--primary-hover);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
        .copy-button i{font-size:0.9em}

        #error-message{text-align:center;margin:16px 0;color:var(--danger-color);font-size:1.2em;padding:20px;border-radius:12px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.2);animation:fadeIn 0.4s ease-out;display:none}

        /* Mobile behaviors */
        .mobile-hamburger{display:none}
        .mobile-side-nav{position:fixed;left:-280px;top:0;width:280px;height:100%;background:var(--modal-bg);z-index:50;overflow-y:auto;padding:20px;transition:left 0.3s ease}
        .mobile-side-nav.active{left:0}
        .close-side{background:none;border:none;color:var(--text-color);font-size:1.8em;cursor:pointer;position:absolute;top:10px;right:10px}
        @media(max-width:768px){
            .desktop-nav{grid-template-columns:1fr auto;margin:5px}
            .nav-center{display:none}
            .controls{display:none}
            .mobile-hamburger{display:block;background:transparent;border:none;font-size:1.2rem;padding:8px;color:var(--text-color);cursor:pointer}
            .mobile-side-nav .search-bar{flex-direction:column;gap:10px;margin-bottom:20px}
            .mobile-side-nav .filter-buttons{flex-direction:column;gap:10px;margin-bottom:20px}
            .mobile-side-nav .theme-toggle{display:flex;justify-content:center;margin-top:auto;margin-bottom:20px;border:1px solid var(--glass-border);border-radius:12px;padding:10px}
            .advantages{display:flex;flex-direction:row;justify-content:space-between;gap:5px;width:100%;padding:0 10px;box-sizing:border-box}
            .advantage-card{min-width:auto;flex:1;padding:12px;text-align:center;font-size:0.9em}
            .advantage-number{font-size:1.2rem}
            .hero-title{font-size:1.5rem}
            .details-header{flex-direction:column;text-align:center}
            .header-info h3{font-size:1.8em}
            .details-tags{justify-content:center}
            .modal-content{margin:20px auto;padding:20px}
            .modal{padding:10px}
        }

        /* small tweaks */
        .pagination{display:flex;justify-content:center;margin-top:10px;gap:12px}
        .pagination button{padding:10px 20px;font-size:1em;border-radius:8px;border:none;background:var(--primary-color);color:#ffffff;cursor:pointer;transition:background-color 0.3s ease}
        .pagination button:hover{background:var(--primary-hover)}
        .pagination button:disabled{opacity:0.5;cursor:not-allowed;background:var(--glass-bg);color:var(--text-color)}
        .filter-buttons{display:flex;gap:8px;flex-wrap:wrap}
        .filter-button{padding:8px 12px;border-radius:8px;border:none;background:var(--glass-bg);color:var(--text-color);cursor:pointer;transition:all 0.3s ease}
        .filter-button:hover{background:var(--primary-color);color:white}
        .filter-button.active{background:var(--primary-color);color:white}
        .footer{text-align:center;padding:25px;margin-top:60px;animation:fadeIn 1s ease-out}
        .footer a{color:var(--primary-color);text-decoration:none;font-weight:bold;transition:all 0.3s ease}
        .footer a:hover{color:var(--primary-hover);text-shadow:0 0 10px rgba(110,86,207,0.5)}
        .footer .divider{margin:20px auto;width:50%;height:1px;background:var(--glass-border)}
    </style>
</head>
<body>
    <div class="blob blob1"></div>
    <div class="blob blob2"></div>
    <div class="blob blob3"></div>
    <nav class="desktop-nav glass">
        <div class="left" style="display:flex;align-items:center;gap:10px">
            <button id="mobile-hamburger" class="mobile-hamburger" aria-label="Open menu"><i class="fas fa-bars"></i></button>
            <div class="logo"><h1>SecretDex</h1></div>
        </div>

        <div class="nav-center">
            <div class="search-bar">
                <div class="search-wrapper">
                    <input id="search-input" type="text" class="search-input" placeholder="Search scripts..." />
                    <i class="fas fa-search search-icon"></i>
                </div>
                <button id="search-button" class="search-button"><i class="fas fa-search"></i> Search</button>
            </div>
        </div>

        <div class="controls">
            <div class="filter-buttons desktop-filters">
                <button class="filter-button active" data-filter="all">All</button>
                <button class="filter-button" data-filter="active">Active</button>
                <button class="filter-button" data-filter="verified">Verified</button>
            </div>
            <div class="theme-toggle">
                <button id="theme-button" title="Toggle theme"><i class="fas fa-moon"></i></button>
            </div>
        </div>
    </nav>

    <!-- Mobile side nav -->
    <div id="mobile-side-nav" class="mobile-side-nav glass">
        <button class="close-side" id="mobile-close"><i class="fas fa-times"></i></button>
        <div class="search-bar">
            <div class="search-wrapper">
                <input id="mobile-search-input" type="text" class="search-input" placeholder="Search scripts..." />
                <i class="fas fa-search search-icon"></i>
            </div>
            <button id="mobile-search-button" class="search-button"><i class="fas fa-search"></i> Search</button>
        </div>
        <div class="filter-buttons">
            <button class="filter-button active" data-filter="all">All</button>
            <button class="filter-button" data-filter="active">Active</button>
            <button class="filter-button" data-filter="verified">Verified</button>
        </div>
        <div class="theme-toggle">
            <button id="mobile-theme-button" title="Toggle theme"><i class="fas fa-moon"></i></button>
        </div>
    </div>

    <div class="container">
        <section class="hero-section">
            <h2 class="hero-title">Welcome to SecretDex</h2>
            <p class="hero-desc">Discover and explore the best scripts for your favorite games.</p>
            <div class="advantages">
                <div class="advantage-card">
                    <div class="advantage-number">500+</div>
                    <div class="advantage-text">Scripts Available</div>
                </div>
                <div class="advantage-card">
                    <div class="advantage-number">10k+</div>
                    <div class="advantage-text">Active Users</div>
                </div>
                <div class="advantage-card">
                    <div class="advantage-number">Trusted</div>
                    <div class="advantage-text">Reliable & Secure</div>
                </div>
            </div>
        </section>

        <div id="scripts-grid" class="grid"></div>

        <div class="pagination">
            <button id="prev">Previous</button>
            <button id="next">Next</button>
        </div>

        <div id="error-message"></div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content glass">
            <span class="close"><i class="fas fa-times"></i></span>
            <div class="minimal-details-card"></div>
        </div>
    </div>

    <footer class="footer">
        <p>Made with ❤️ by <a href="https://ffranccc.vercel.app/">Florian</a></p>
        <div class="divider"></div>
        <p>&copy; 2025 SecretDex. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Config
            const proxAPI = 'https://scriptblox.com/api/script/fetch';
            const searchproxAPI = 'https://scriptblox.com/api/script/search';

            // Elements
            const scriptsGrid = document.getElementById('scripts-grid');
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const prevBtn = document.getElementById('prev');
            const nextBtn = document.getElementById('next');
            const errorMsg = document.getElementById('error-message');
            const modal = document.getElementById('modal');
            const modalDetails = document.querySelector('.minimal-details-card');
            const closeModalBtn = document.querySelector('.close');

            // Mobile elements
            const mobileHamburger = document.getElementById('mobile-hamburger');
            const mobileSideNav = document.getElementById('mobile-side-nav');
            const mobileClose = document.getElementById('mobile-close');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            const mobileSearchButton = document.getElementById('mobile-search-button');

            // Controls
            const themeButton = document.getElementById('theme-button');
            const mobileThemeButton = document.getElementById('mobile-theme-button');

            // state
            let currentPage = 1;
            let currentFilter = 'all';
            let currentQuery = '';
            let lastScriptsLength = 0;
            const cache = new Map();

            // Theme toggle
            function updateThemeButton() {
                const isLight = document.body.classList.contains('light-mode');
                if (themeButton) {
                    themeButton.innerHTML = isLight ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                    themeButton.title = isLight ? 'Switch to dark' : 'Switch to light';
                }
                if (mobileThemeButton) {
                    mobileThemeButton.innerHTML = isLight ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                    mobileThemeButton.title = isLight ? 'Switch to dark' : 'Switch to light';
                }
            }
            updateThemeButton();
            if (themeButton) themeButton.addEventListener('click', () => { document.body.classList.toggle('light-mode'); updateThemeButton(); });
            if (mobileThemeButton) mobileThemeButton.addEventListener('click', () => { document.body.classList.toggle('light-mode'); updateThemeButton(); });

            // Mobile side nav toggles
            if (mobileHamburger) mobileHamburger.addEventListener('click', () => { mobileSideNav.classList.add('active'); });
            if (mobileClose) mobileClose.addEventListener('click', () => { mobileSideNav.classList.remove('active'); });
            if (mobileSideNav) mobileSideNav.addEventListener('click', (e) => { if (e.target === mobileSideNav) mobileSideNav.classList.remove('active'); });

            // Mobile search
            if (mobileSearchButton) mobileSearchButton.addEventListener('click', () => {
                currentQuery = mobileSearchInput.value.trim();
                if (searchInput) searchInput.value = currentQuery;
                mobileSideNav.classList.remove('active');
                currentPage = 1;
                loadScripts();
            });

            // Filter buttons (both desktop and mobile) - delegate
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter || 'all';
                    currentPage = 1;
                    loadScripts();
                });
            });

            // Pagination - with disable logic based on response length
            function updatePaginationButtons(scriptsLength) {
                prevBtn.disabled = currentPage <= 1;
                nextBtn.disabled = scriptsLength < 10; // Assume 10 per page, disable if less
            }
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadScripts();
                }
            });
            nextBtn.addEventListener('click', () => {
                if (!nextBtn.disabled) {
                    currentPage++;
                    loadScripts();
                }
            });

            // Search (desktop)
            if (searchButton) searchButton.addEventListener('click', () => {
                currentQuery = searchInput.value.trim();
                if (mobileSearchInput) mobileSearchInput.value = currentQuery;
                currentPage = 1;
                loadScripts();
            });

            // Close modal handlers
            if (closeModalBtn) closeModalBtn.addEventListener('click', hideModal);
            if (modal) modal.addEventListener('click', (e) => { if (e.target === modal) hideModal(); });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') hideModal(); });

            // Search input enhancements
            [searchInput, mobileSearchInput].forEach(input => {
                if (input) {
                    input.addEventListener('focus', () => { input.parentElement.style.transform = 'scale(1.02)'; });
                    input.addEventListener('blur', () => { input.parentElement.style.transform = 'scale(1)'; });
                    input.addEventListener('keydown', (event) => { if (event.key === 'Enter') { if (searchButton) searchButton.click(); else if (mobileSearchButton) mobileSearchButton.click(); } });
                }
            });

            // Load on start
            loadScripts();

            // --- functions ---
            function hideModal() { if (modal) modal.style.display = 'none'; }

            async function loadScripts() {
                errorMsg.style.display = 'none';
                const cacheKey = `${currentPage}_${currentFilter}_${currentQuery}`;
                if (cache.has(cacheKey)) {
                    const scripts = cache.get(cacheKey);
                    renderScripts(scripts);
                    updatePaginationButtons(scripts.length);
                    return;
                }

                try {
                    let url;
                    if (currentQuery) {
                        // use search endpoint
                        url = new URL(searchproxAPI);
                        url.searchParams.append('q', currentQuery);
                        url.searchParams.append('page', currentPage);
                        if (currentFilter === 'active') url.searchParams.append('patched', '0');
                        if (currentFilter === 'verified') url.searchParams.append('verified', '1');
                    } else {
                        // fetch endpoint
                        url = new URL(proxAPI);
                        url.searchParams.append('page', currentPage);
                        if (currentFilter === 'active') url.searchParams.append('patched', '0');
                        if (currentFilter === 'verified') url.searchParams.append('verified', '1');
                    }

                    const res = await fetch(url.toString());
                    if (!res.ok) throw new Error(`API Error ${res.status}: ${res.statusText}`);
                    const data = await res.json();

                    const scripts = (data?.result?.scripts) || (Array.isArray(data) ? data : []);

                    if (Array.isArray(scripts) && scripts.length === 0) {
                        renderScripts([]);
                        errorMsg.textContent = 'No scripts found.';
                        errorMsg.style.display = 'block';
                        updatePaginationButtons(0);
                        return;
                    }

                    cache.set(cacheKey, scripts);
                    renderScripts(scripts);
                    updatePaginationButtons(scripts.length);
                } catch (err) {
                    renderScripts([]);
                    errorMsg.textContent = err.message || 'Failed to fetch data.';
                    errorMsg.style.display = 'block';
                    updatePaginationButtons(0);
                }
            }

            function renderScripts(scripts) {
                scriptsGrid.innerHTML = '';
                scripts.forEach(script => {
                    const title = (script.title || 'Untitled');
                    const displayTitle = title.length > 60 ? title.slice(0, 60) + '...' : title;
                    let gameName = (script.game && script.game.name) ? script.game.name : 'Universal';
                    let imgSrc = (script.game && script.game.imageUrl) ? (script.game.imageUrl.startsWith('http') ? script.game.imageUrl : `https://scriptblox.com${script.game.imageUrl}`) : 'https://files.catbox.moe/gamwb1.jpg';

                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <img src="${imgSrc}" alt="${escapeHtml(displayTitle)}" loading="lazy" onerror="this.src='https://files.catbox.moe/gamwb1.jpg'" />
                        <div class="card-content">
                            <h3 class="card-title">${escapeHtml(displayTitle)}</h3>
                            <div class="card-game">Game: ${escapeHtml(gameName)}</div>
                        </div>
                    `;
                    card.addEventListener('click', () => displayDetails(script));
                    scriptsGrid.appendChild(card);
                });
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            function displayDetails(script) {
                const gameName = script.game?.name || 'Universal';
                const gameImage = script.game?.imageUrl
                    ? script.game.imageUrl.startsWith('http')
                        ? script.game.imageUrl
                        : `https://scriptblox.com${script.game.imageUrl}`
                    : 'https://files.catbox.moe/gamwb1.jpg';

                if (!script.script) {
                    window.location.href = `https://scriptblox.com/script/${script.slug}`;
                    return;
                }
                
                const maxModalTitleLength = 20;
                const modalDisplayTitle = script.title.length > maxModalTitleLength
                    ? script.title.substring(0, maxModalTitleLength) + '...'
                    : script.title;
                
                modalDetails.innerHTML = `
                    <div class="details-header">
                        <div class="header-image">
                            <img src="${gameImage}" alt="${gameName}" onerror="this.src='https://files.catbox.moe/gamwb1.jpg';">
                        </div>
                        <div class="header-info">
                            <h3>${escapeHtml(modalDisplayTitle)}</h3>
                            <div class="details-tags">
                                <span class="tag ${script.verified ? 'verified' : 'not-verified'}">
                                    <i class="fas fa-${script.verified ? 'check-circle' : 'times-circle'}"></i>
                                    ${script.verified ? 'Verified' : 'Not Verified'}
                                </span>
                                <span class="tag ${script.isPatched ? 'patched' : 'active'}">
                                    <i class="fas fa-${script.isPatched ? 'ban' : 'check'}"></i>
                                    ${script.isPatched ? 'Patched' : 'Active'}
                                </span>
                                <span class="tag ${script.scriptType === 'paid' ? 'paid' : ''}">
                                    <i class="fas fa-${script.scriptType === 'paid' ? 'dollar-sign' : 'code'}"></i>
                                    ${script.scriptType ? script.scriptType.charAt(0).toUpperCase() + script.scriptType.slice(1) : 'Free'}
                                </span>
                                ${script.key ? `
                                    <span class="tag key">
                                        <i class="fas fa-key"></i>
                                        Requires Key
                                    </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="details-section">
                        <h4><i class="fas fa-info-circle"></i> Details</h4>
                        <div class="details-info">
                            <div class="info-item">
                                <i class="fas fa-eye"></i>
                                <span>${script.views?.toLocaleString() || 0} Views</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Created: ${script.createdAt ? new Date(script.createdAt).toLocaleDateString() : 'Unknown'}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-calendar-check"></i>
                                <span>Updated: ${script.updatedAt ? new Date(script.updatedAt).toLocaleDateString() : 'Unknown'}</span>
                            </div>
                            ${script.key ? `
                                <div class="info-item">
                                    <i class="fas fa-key"></i>
                                    <a href="${script.keyLink || '#'}" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: underline;">Get Key</a>
                                </div>
                            ` : ''}
                        </div>
                    </div>

                    <div class="script-box">
                        <h4><i class="fas fa-code"></i> Script</h4>
                        <div class="code-container">
                            <pre>${escapeHtml(script.script || 'No script available.')}</pre>
                            <button class="copy-button">
                                <i class="fas fa-copy"></i>
                                Copy Script
                            </button>
                        </div>
                    </div>
                `;

                const copyButton = modalDetails.querySelector('.copy-button');
                if (copyButton) {
                    copyButton.addEventListener('click', () => {
                        navigator.clipboard.writeText(script.script || 'No script available.').then(() => {
                            copyButton.innerHTML = '<i class="fas fa-check"></i> Copied!';
                            setTimeout(() => {
                                copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy Script';
                            }, 2000);
                        });
                    });
                }

                if (modal) modal.style.display = 'flex';
            }
        });
    </script>
</body>
</html>
